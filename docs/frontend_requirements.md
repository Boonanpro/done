# フロントエンド要件仕様書

> AI秘書システム「Done」のフロントエンド要件

---

## 1. 基本情報

### 1.1 対象ユーザー
まずは自分が満足するものを作ってから一般公開したい。

### 1.2 対応デバイス
- **優先**: PC（デスクトップ）
- **将来対応**: スマートフォン（近い将来、十分に使えるようにしたい）

→ **デスクトップファーストで設計し、レスポンシブ対応を考慮した実装**

### 1.3 対応言語
- 日本語
- 英語
- ユーザーが切り替え可能

---

## 2. 画面一覧

| 画面名 | 優先度 | 説明 |
|--------|--------|------|
| ログイン画面 | MVP | 認証画面 |
| 新規登録画面 | MVP | アカウント作成画面 |
| ダンとのチャット画面（メイン画面） | MVP | AI秘書との1対1チャット |
| チャットwithダンの画面 | MVP | 友達（人間）とのチャット |
| 通知コンポーネント | MVP | 右下の展開可能な通知エリア |
| プロセスモニター | MVP | タスク実行状況のリアルタイム表示 |
| 設定画面 | MVP | プロフィール・パスワード・決済情報管理 |

---

## 3. 各画面の詳細

### 3.1 ログイン画面

#### 認証方法
- メールアドレス + パスワード

#### セッション維持
- できるだけ長くログイン状態を維持したい
- → **リフレッシュトークンで長期セッション（1週間〜1ヶ月程度）を実装**

#### ソーシャルログイン
- **MVP**: メール + パスワードのみ
- **Phase 2**: Googleログイン追加を検討

---

### 3.2 新規登録画面

#### 登録方式
- **誰でも登録可能**（公開登録制）
- 友達追加URL発行機能あり
- 公式サイトからもアクセス可能

#### 登録フロー
1. メールアドレス入力
2. パスワード設定
3. メール認証（オプション）
4. 登録完了

---

### 3.3 ダンとのチャット画面（メイン画面）

#### UIイメージ
**ChatGPT / Gemini / Claude のようなLLMチャットUI**

#### レイアウト（PC）
```
┌─────────────────────────────────────────────────────────┐
│ ┌──────────┐ ┌────────────────────────────────────────┐ │
│ │          │ │                                        │ │
│ │ サイド   │ │                                        │ │
│ │ バー     │ │         チャットエリア                  │ │
│ │          │ │                                        │ │
│ │ (10%)    │ │         (90%)                          │ │
│ │          │ │                                        │ │
│ │ ・新規   │ │                                        │ │
│ │ ・履歴1  │ │                                        │ │
│ │ ・履歴2  │ │                            ┌─────────┐ │ │
│ │ ・履歴3  │ │                            │ 通知    │ │ │
│ │   ...    │ │                            │ コンポ  │ │ │
│ └──────────┘ └────────────────────────────┴─────────┴─┘ │
└─────────────────────────────────────────────────────────┘
```

#### サイドバー機能
- チャット履歴一覧を表示
- **新しい会話ほど上部に表示**
- 各履歴に×ボタンでチャット削除可能
- 新規チャット作成ボタン
- **チャット履歴検索機能**

#### チャットエリア機能
- ダンとのメッセージ送受信
- リアルタイム更新（WebSocket）
- 過去のやり取りをスクロールで遡れる
- **ファイル・画像添付機能**
- **メッセージ編集・削除機能**

#### 通知コンポーネント（右下）
- 展開/折りたたみ可能
- 詳細は「3.6 通知コンポーネント」を参照

---

### 3.4 チャットwithダンの画面（友達とのチャット）

#### UIイメージ
**LINEのようなメッセージングUI**

#### レイアウト（PC）
```
┌─────────────────────────────────────────────────────────┐
│ ┌──────────┐ ┌────────────────────────────────────────┐ │
│ │          │ │ [友達名]              [AI: ON/OFF]     │ │
│ │ 友だち   │ ├────────────────────────────────────────┤ │
│ │ 一覧     │ │                                        │ │
│ │          │ │         チャットエリア                  │ │
│ │ (10%)    │ │                                        │ │
│ │          │ │         (90%)                          │ │
│ │ ・友達A  │ │                                        │ │
│ │ ・友達B  │ │                                        │ │
│ │ ・友達C  │ │                                        │ │
│ │   ...    │ │                                        │ │
│ └──────────┘ └────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

#### サイドバー機能
- 友だち一覧を表示
- **新メッセージが届いた友達は最上部に表示**
- 未読バッジ表示

#### チャットエリア機能
- 友達とのメッセージ送受信
- リアルタイム更新（WebSocket）
- **ファイル・画像添付機能**
- **メッセージ編集・削除機能**
- **通知コンポーネントは非表示**

#### AI介入機能（重要）

**ON/OFFトグル**
- 友達とのチャットごとにAI介入のON/OFFを選択可能
- 相手の設定とは独立（自分ON・相手OFF、両方ONなど可能）

**ONの場合**
- 相手からのメッセージに対してダン（AI）が代わりにコミュニケーション
- ユーザーが途中でOFFからONにすると、続きからダンが対応

**OFFの場合**
- ユーザー自身がメッセージを返信

#### ダンの記憶共有
- ダンは**単一の人格**として全てのチャット（メイン画面・友達チャット）の記憶を共有
- メイン画面で依頼したタスクAに関連するメッセージが友達から届いた場合：
  - → Aについて話している適切なチャットに通知を振り分け
- メイン画面と無関係の内容の場合：
  - → メイン画面の通知コンポーネントに通知

#### AIの動作フロー
1. **基本**: メイン画面から操作（タスクに基づいて必要な相手にメッセージ送信）
2. **引き継ぎ**: チャットwithダン画面でユーザーが始めた会話をダンが引き継ぐことも可能
   - 例: ダンONでユーザーがメッセージ送信 → 相手の返信はダンが対応
   - 例: OFFで会話中 → ONに切り替え → 続きはダンが対応

---

### 3.5 プロセスモニター（タスク実行状況）

#### 概要
タスク実行中の進捗をリアルタイムで細かく表示する機能。
**Cursorのプロセス共有技術を参考に実装。**

#### 目的
- 最終結果の生成に時間がかかっても、「今システムが何をしているか」を表示することでレスポンスが早く感じられる
- ユーザビリティの向上

#### 表示内容
- 動作直後から結果出力まで細かく状況を共有
- 例:
  - 「ログイン中...」
  - 「フォーム入力中...」
  - 「確認画面を検証中...」
  - 「完了！」

#### UI案
```
┌─────────────────────────────────┐
│ 🔄 新幹線予約                   │
├─────────────────────────────────┤
│ ✓ えきねっとにログイン          │
│ ✓ 検索条件を入力               │
│ → 空席を確認中...              │
│ ○ 予約確定                     │
│ ○ 完了通知                     │
└─────────────────────────────────┘
```

---

### 3.6 通知コンポーネント

#### 配置
- メイン画面の**右下**
- **展開/折りたたみ可能**

#### 通知内容
- 紐づいているメールアドレスで検知した請求書・案内
- メイン画面で話していないが対応が必要な件
- 承認待ちのタスク

#### インタラクション
```
┌─────────────────────────────┐
│ 📬 通知 (3件)          [▼] │  ← クリックで展開
├─────────────────────────────┤
│ ┌─────────────────────────┐ │
│ │ 📄 請求書: ○○株式会社   │ │  ← クリックで詳細表示
│ │ ¥50,000 / 期限: 1/15   │ │
│ └─────────────────────────┘ │
│ ┌─────────────────────────┐ │
│ │ ✉️ 新規案内: △△サービス  │ │
│ └─────────────────────────┘ │
│ ┌─────────────────────────┐ │
│ │ ⚡ タスク確認: 予約変更  │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

#### 詳細表示時の機能
- タスク/通知の内容表示
- **承認ボタン**
- **編集ボタン**
- **小チャット機能**: その件についてユーザーが自然言語で質問・指示可能

#### ブラウザプッシュ通知
- タブを開いていない時でもデスクトップ通知を受け取れる
- 通知音は**なし**

---

### 3.7 設定画面

#### 機能一覧

| カテゴリ | 機能 |
|----------|------|
| **プロフィール** | 名前の編集 |
| **プロフィール** | アイコン画像の変更 |
| **セキュリティ** | パスワード変更 |
| **決済情報** | ネットバンキングログイン情報の登録・編集・削除 |
| **決済情報** | クレジットカード番号の登録・編集・削除 |
| **言語** | 日本語 / 英語 の切り替え |

#### 決済情報のセキュリティ
- 保存時は暗号化必須
- 表示時はマスク表示（例: `**** **** **** 1234`）
- 削除時は確認ダイアログ表示

---

## 4. デザイン仕様

### 4.1 全体方針
- **シンプル**なデザイン
- 無駄な装飾を排除し、機能性重視

### 4.2 カラースキーム
- **ダークモードのみ**
- **モノトーン**（白・グレー・黒を基調）

### 4.3 参考イメージ
- Cursor のUI/UX
- VSCode のダークテーマ
- 各種LLMチャットUI（ChatGPT、Claude）

---

## 5. 機能仕様まとめ

### 5.1 チャット機能

| 機能 | 対応 |
|------|------|
| ファイル・画像添付 | ✅ あり |
| メッセージ編集 | ✅ あり |
| メッセージ削除 | ✅ あり |
| チャット履歴検索 | ✅ あり |
| コードブロック/Markdown表示 | ❌ なし |

### 5.2 通知機能

| 機能 | 対応 |
|------|------|
| 通知音 | ❌ なし |
| ブラウザプッシュ通知 | ✅ あり |

### 5.3 その他

| 機能 | 対応 |
|------|------|
| 多言語対応（日本語/英語） | ✅ あり |
| オフライン対応 | ❌ MVP不要（将来検討） |

---

## 6. 技術要件

### 6.1 認証
- メール + パスワード認証
- HttpOnly Cookie でセッション管理
- リフレッシュトークンによる長期セッション維持

### 6.2 リアルタイム通信
- WebSocket を使用
- チャットメッセージのリアルタイム更新
- プロセスモニターのリアルタイム更新
- 通知のリアルタイム更新

### 6.3 セキュリティ
- CSRF対策（SameSite Cookie）
- 決済情報の暗号化保存
- HTTPS必須（本番環境）

---

## 7. 補足情報

### 記入日
2024年12月29日

### 最終更新日
2024年12月31日

### ステータス
✅ **完成**

---

## 8. 次のステップ

1. ✅ 要件仕様書完成
2. ⬜ 技術スタック選定（`frontend_plan.md` Phase 1.2）
3. ⬜ バックエンド調整（Cookie認証 + リフレッシュトークン）
4. ⬜ フロントエンド基盤構築
5. ⬜ MVP画面実装
