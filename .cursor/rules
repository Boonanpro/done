# Done プロジェクト - AI開発アシスタント向けルール

このファイルはAIアシスタントがプロジェクトで作業する際に必ず従うルールです。

---

## 1. 最初に必ず読むこと

### README.md の「開発フロー（必ず守ること）」セクション
実装ルールは README.md に記載されている。作業開始前に必ず確認すること。

要約：
- 1つ実装 → 手動テスト → 自動テスト → README更新 → コミット
- **まとめてコミットは禁止**（1機能 = 1コミット）
- 自動テストが通らないとコミットしない

---

## 2. 現状把握ルール

プロジェクトの現状を把握する際は、以下の順序で調査すること：

### 2.1 ソースコードを先に読む（最重要）
- **ドキュメントより先に実際の実装ファイルを読む**
- 特に主要なエントリーポイントを確認：
  - `app/agent/agent.py` - AIエージェントのメインロジック
  - `app/api/routes.py` - APIエンドポイント
  - `main.py` - アプリケーションエントリーポイント

### 2.2 統合状況を確認する
- 機能がインポートされて**実際に使われているか**確認
- APIエンドポイントとして公開されているか確認
- **ファイルの存在だけで「実装済み」と判断しない**

### 2.3 テストの存在確認
- `tests/` フォルダに対応するテストがあるか確認
- テストがあれば動作確認済みの可能性が高い

### 2.4 ドキュメントは参考程度に
- README.md や docs/ は計画と実装が混在している可能性がある
- 実装の「証拠」としては**ソースコードを優先**する
- 「✅ 動作確認済み」と明記されている場合のみ信頼する

---

## 3. 実装時のルール

### 3.1 要件仕様書の作成
新機能を実装する前に：
1. `docs/` に要件仕様書を作成
2. API一覧（エンドポイント、リクエスト/レスポンス形式）を明記
3. テストコード一覧（何をテストするか）を明記
4. 実装ステップ（1件ずつ確認できる粒度）を明記

### 3.2 1件ずつ動作確認 → コミット
```
1. API/機能を1件実装
    ↓
2. 手動でAPIをテスト（curl/Invoke-RestMethod）
    ↓
3. 成功したら → 自動テストを作成/確認（pytest）
    ↓
4. 自動テストが通ったら → README.md・関連ドキュメントを更新
    ↓
5. コミット（1件 = 1コミット）
    ↓
6. 次の機能へ
```

### 3.3 コミットメッセージ規則
- 何を実装したか明確に記載
- 例: `feat: add search_train API for Yahoo Transit`
- 例: `test: add test for search_train API`
- 例: `docs: update README with Phase 3A status`

---

## 4. 品質チェックリスト

機能を「完成」と報告する前に確認：

- [ ] 実装ファイルの中身を読んで確認したか？
- [ ] エントリーポイント（agent.py等）でインポート・使用されているか？
- [ ] APIルートで公開されているか？（該当する場合）
- [ ] 手動テストで動作確認済みか？
- [ ] 自動テスト（pytest）が存在し、通過するか？
- [ ] README.md に「動作確認済み」と記載されているか？
- [ ] コミット済みか？

---

## 5. 禁止事項

- ❌ ドキュメントだけを読んで実装状況を判断する
- ❌ 複数の機能をまとめてコミットする
- ❌ テストなしで「完成」と報告する
- ❌ README.md を更新せずにコミットする
- ❌ ファイルの存在だけで「実装済み」と判断する

---

## 6. ファイル構成

```
app/
├── api/           # APIルート（新エンドポイントはここ）
├── agent/         # AIエージェントロジック
├── executors/     # サービス別実行ロジック（Playwright）
├── models/        # Pydanticスキーマ
├── services/      # ビジネスロジック
└── tools/         # LangChainツール（検索等）

tests/             # 自動テスト（pytest）
docs/              # 仕様書・設計ドキュメント
supabase/migrations/  # DBスキーマ
```

---

## 7. Python実行環境

### 7.1 仮想環境の使用（必須）
このプロジェクトでは `venv` フォルダにある仮想環境を使用すること。

**仮想環境のパス:**
```
d:\done\venv
```

### 7.2 Python/pipコマンド実行時のルール

**Windows（PowerShell）の場合:**
```powershell
# 仮想環境のPythonを直接指定して実行
d:\done\venv\Scripts\python.exe <スクリプト>
d:\done\venv\Scripts\pip.exe install <パッケージ>

# または仮想環境をアクティベート
d:\done\venv\Scripts\Activate.ps1
python <スクリプト>
```

**実行例:**
```powershell
# テスト実行
d:\done\venv\Scripts\python.exe -m pytest tests/

# パッケージインストール
d:\done\venv\Scripts\pip.exe install -r requirements.txt

# アプリケーション起動
d:\done\venv\Scripts\python.exe main.py
```

### 7.3 禁止事項
- ❌ システムのPython（`python` / `python3`）を直接使用しない
- ❌ 新しい仮想環境を作成しない（既存の `venv` を使用）
- ❌ グローバルにパッケージをインストールしない

